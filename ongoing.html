<!doctype html>
<html lang="nl">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1" />
  <title>Doorlopende projecten</title>
  <link rel="stylesheet" href="styles.css" />
  <style>
    .grid{
      display:grid;
      grid-template-columns: 1.05fr .95fr;
      gap: var(--gap);
      align-items:start;
    }
    @media (max-width: 980px){ .grid{grid-template-columns:1fr;} }

    .items{padding:14px; display:grid; gap:10px; position:relative; z-index:1;}
    .item{
      display:grid;
      grid-template-columns: 84px 1fr;
      gap: 12px;
      align-items:center;
      padding: 10px;
      border: 2px solid var(--line);
      text-decoration:none;
      background: rgba(247,246,241,.92);
      transition: transform .12s ease;
    }
    .item:hover{transform: translateY(-1px);}
    .thumb{width:84px; height:58px; border:2px solid var(--line); overflow:hidden; background:transparent;}
    .thumb img{width:100%; height:100%; object-fit:cover; display:block;}
    .meta b{font-size:12px; font-weight:800; letter-spacing:.06em; text-transform:uppercase; line-height:1.2;}
    .meta div{color:var(--muted); font-size:13.5px; line-height:1.45; margin-top:4px;}

    .timeline{padding: 14px; position:relative; z-index:1; display:grid; gap: 14px;}
    .step{border: 2px solid var(--line); padding: 12px; background: rgba(247,246,241,.92);} 
    .step h3{margin:0 0 8px; font-size:12px; letter-spacing:.08em; text-transform:uppercase;}
    .step p{margin:0; color:var(--muted); font-size:14px; line-height:1.6;}

    .filters{
      position:relative;
      z-index:1;
      padding:14px;
      border-bottom:2px solid var(--line);
      background: rgba(247,246,241,.92);
      display:grid;
      gap:12px;
    }
    .filtersRow{display:flex; flex-wrap:wrap; gap:10px; align-items:center; justify-content:space-between;}
    .count{color:var(--muted); font-size:13.5px;}
  </style>
</head>
<body>
  <div class="wrap">
    <header>
      <div class="brand">
        <h1>Doorlopende projecten</h1>
        <p>Projecten die niet “af” zijn, maar doorwerken: iteraties, terugkeren, vertakken.</p>
      </div>
      <nav>
        <a class="link" href="index.html">Landing</a>
        <a class="link" href="portfolio.html">Portfolio</a>
        <a class="link" href="about.html">About</a>
        <a class="link accent" href="ongoing.html">Ongoing</a>
      </nav>
    </header>

    <section class="grid">
      <div class="panel">
        <div class="panelHead">
          <div>
            <p class="kicker">Ongoing index</p>
            <p class="sub">Een lijst van doorlopende trajecten — elk een wortelstok met uitlopers.</p>
          </div>
          <div class="pill">Doorlopend <small id="pill">—</small></div>
        </div>

        <div class="filters" aria-label="Filters">
          <div class="filtersRow">
            <div class="controls">
              <input class="input" id="q" type="search" placeholder="Zoek in ongoing…" autocomplete="off" />
              <button class="btn" id="clear" type="button">Reset</button>
            </div>
            <div class="count" id="count">—</div>
          </div>
          <div class="tags" id="tags" aria-label="Tags"></div>
        </div>

        <div class="items" id="ongoingItems"></div>
      </div>

      <div class="panel">
        <div class="panelHead">
          <div>
            <p class="kicker">Rhizoom map</p>
            <p class="sub">Wat groeit door, wat vertakt, wat migreert naar nieuwe contexten.</p>
          </div>
          <div class="pill">Notities <small>live</small></div>
        </div>
        <div class="timeline">
          <div class="step">
            <h3>1 — Uitlopers</h3>
            <p>Elke samenwerking laat sporen na: formats, zinnen, scores, objecten. Die keren terug in andere vormen.</p>
          </div>
          <div class="step">
            <h3>2 — Verplaatsing</h3>
            <p>Een project verhuist: straat → museum → strand → dome. Betekenis verschuift mee.</p>
          </div>
          <div class="step">
            <h3>3 — Herhaling met verschil</h3>
            <p>Niet reproduceren, maar hernemen. Een rhizoom is een techniek van variatie.</p>
          </div>
        </div>
      </div>
    </section>

    <div class="card">
      <h3>Waarom apart?</h3>
      <p>Doorlopende projecten maken groei zichtbaar: niet alleen output, ook de werkvorm en de wortelstok eronder.</p>
    </div>

    <div class="footer">
      <div>© <span id="y"></span> Thijs van de Loo</div>
      <div><a href="about.html">Contact</a></div>
    </div>
  </div>

  <script src="data/ongoing.js"></script>
  <script>
    const ongoing = Array.isArray(window.ONGOING) ? window.ONGOING : [];
    const el = document.getElementById("ongoingItems");
    const elQ = document.getElementById('q');
    const elTags = document.getElementById('tags');
    const elCount = document.getElementById('count');
    const elPill = document.getElementById('pill');

    const selected = new Set();

    const tagCounts = new Map();
    ongoing.forEach(p => (p.tags || []).forEach(t => tagCounts.set(t, (tagCounts.get(t) || 0) + 1)));
    const tagList = Array.from(tagCounts.entries())
      .sort((a,b) => b[1]-a[1] || a[0].localeCompare(b[0], 'nl'))
      .map(([t,count]) => ({t,count}));

    renderTags();
    render();

    elQ.addEventListener('input', render);
    document.getElementById('clear').addEventListener('click', () => {
      selected.clear();
      elQ.value = '';
      renderTags();
      render();
      elQ.focus();
    });

    function renderTags(){
      elTags.innerHTML = '';
      tagList.forEach(({t,count}) => {
        const b = document.createElement('button');
        b.type = 'button';
        b.className = 'tag';
        b.setAttribute('aria-pressed', selected.has(t) ? 'true' : 'false');
        b.innerHTML = `${escapeHtml(t)} <small class="mono">${count}</small>`;
        b.addEventListener('click', () => {
          if(selected.has(t)) selected.delete(t); else selected.add(t);
          renderTags();
          render();
        });
        elTags.appendChild(b);
      });
    }

    function applyFilters(){
      const q = elQ.value.trim().toLowerCase();
      const tags = Array.from(selected);
      return ongoing.filter(p => {
        if(q){
          const hay = `${p.title||''} ${p.excerpt||''} ${(p.tags||[]).join(' ')}`.toLowerCase();
          if(!hay.includes(q)) return false;
        }
        if(tags.length){
          const set = new Set(p.tags || []);
          for(const t of tags) if(!set.has(t)) return false;
        }
        return true;
      });
    }

    function render(){
      const filtered = applyFilters();
      elPill.textContent = `${filtered.length} lijnen`;
      elCount.textContent = `${filtered.length} / ${ongoing.length} items`;

      el.innerHTML = '';
      filtered.forEach(p => {
        const a = document.createElement("a");
        a.className = "item";
        a.href = "ongoing-project.html?id=" + encodeURIComponent(p.id);
        a.innerHTML = `
          <div class="thumb"><img src="${p.image}" alt="${escapeHtml(p.title)}"></div>
          <div class="meta">
            <b>${escapeHtml(p.title)}</b>
            <div>${escapeHtml(p.year)} • ${escapeHtml(p.excerpt)}</div>
          </div>
        `;
        el.appendChild(a);
      });
    }

    function escapeHtml(str){
      return String(str ?? "").replace(/[&<>"']/g, s => ({"&":"&amp;","<":"&lt;",">":"&gt;",'"':"&quot;","'":"&#39;"}[s]));
    }

    document.getElementById('y').textContent = new Date().getFullYear();
  </script>
</body>
</html>
