<!doctype html>
<html lang="nl">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1" />
  <title>Project</title>
  <link rel="stylesheet" href="styles.css" />
  <style>
    .detail {
      border: 2px solid var(--line);
      overflow:hidden;
      position:relative;
    }
    .detail::before {
      content:"";
      position:absolute;
      inset:-2px;
      background: url("images/rhizome.svg") center/cover no-repeat;
      opacity:.12;
      pointer-events:none;
    }
    .detailHead {
      position:relative;
      z-index:1;
      padding:14px;
      border-bottom:2px solid var(--line);
      display:flex;
      justify-content:space-between;
      align-items:flex-end;
      gap:12px;
      background: rgba(247,246,241,.92);
    }
    .detailHead h2 {
      margin:0;
      font-size:12px;
      font-weight:800;
      letter-spacing:.08em;
      text-transform:uppercase;
    }
    .detailHead p {
      margin:8px 0 0;
      color:var(--muted);
      font-size:13.5px;
      line-height:1.5;
      max-width: 70ch;
    }
    .body {
      position:relative;
      z-index:1;
      display:grid;
      grid-template-columns: 1.15fr .85fr;
      gap:0;
      background: rgba(247,246,241,.92);
    }
    @media (max-width: 980px){ .body{grid-template-columns:1fr;} }
    .imgWrap {
      padding:14px;
      border-right:2px solid var(--line);
      background:
        linear-gradient(to right, rgba(17,17,17,.04) 1px, transparent 1px),
        linear-gradient(to bottom, rgba(17,17,17,.04) 1px, transparent 1px);
      background-size: 22px 22px;
    }
    @media (max-width: 980px){ .imgWrap{border-right:0; border-bottom:2px solid var(--line);} }
    .imgWrap img {
      width:100%;
      height:auto;
      max-height:74vh;
      object-fit:contain;
      border:2px solid var(--line);
      display:block;
      background: transparent;
    }
    .text {
      padding:14px;
      display:grid;
      gap: 14px;
      align-content:start;
    }
    .text h3 {
      margin:0 0 10px;
      font-size:12px;
      letter-spacing:.08em;
      text-transform:uppercase;
    }
    .text p {
      margin:0;
      color:var(--muted);
      font-size:14.5px;
      line-height:1.65;
      white-space:pre-line;
    }
    .notfound {
      border:2px solid var(--line);
      padding:14px;
      color:var(--muted);
      line-height:1.6;
      background: rgba(247,246,241,.92);
    }
    .rel{
      display:grid;
      gap:10px;
    }
    .rel a{
      border:2px solid var(--line);
      padding:10px;
      text-decoration:none;
      background: rgba(247,246,241,.92);
      display:flex;
      justify-content:space-between;
      gap:12px;
      align-items:baseline;
    }
    .rel a b{font-size:12px; font-weight:800; letter-spacing:.06em; text-transform:uppercase;}
    .rel a span{color:var(--muted); font-size:13px; white-space:nowrap;}
  </style>
</head>
<body>
  <div class="wrap">
    <header>
      <div class="brand">
        <h1 id="t">Project</h1>
        <p id="s">—</p>
      </div>
      <nav>
        <a class="link" href="portfolio.html">← Portfolio</a>
        <a class="link" href="ongoing.html">Doorlopende projecten</a>
        <a class="link" href="about.html">About</a>
        <a class="link accent" href="index.html">Landing</a>
      </nav>
    </header>

    <div id="root"></div>

    <div class="footer">
      <div>© <span id="y"></span> Thijs van de Loo</div>
      <div><a href="about.html">Contact</a></div>
    </div>
  </div>

  <script src="data/projects.js"></script>
  <script src="data/ongoing.js"></script>
  <script>
    const projects = Array.isArray(window.PROJECTS) ? window.PROJECTS : [];
    const ongoing = Array.isArray(window.ONGOING) ? window.ONGOING : [];

    const params = new URLSearchParams(location.search);
    const id = Number(params.get("id"));
    const p = projects.find(x => x.id === id);

    const root = document.getElementById("root");
    const t = document.getElementById("t");
    const s = document.getElementById("s");

    if(!p){
      t.textContent = "Project niet gevonden";
      s.textContent = "Controleer de link (bijv. project.html?id=1).";
      root.innerHTML = `<div class="notfound">Geen project gevonden voor <code>${escapeHtml(String(params.get("id")))}</code>.</div>`;
    } else {
      const tagHtml = (p.tags || []).map(tag => `<span class="tag" aria-pressed="false">${escapeHtml(tag)}</span>`).join(' ');
      const rel = (p.relatedOngoing || [])
        .map(oid => ongoing.find(o => o.id === oid))
        .filter(Boolean);

      t.textContent = p.title;
      s.textContent = `${p.year} • ${p.excerpt}`;

      root.innerHTML = `
        <article class="detail">
          <div class="detailHead">
            <div>
              <h2>${escapeHtml(p.title)}</h2>
              <p>${escapeHtml(p.year)} • ${escapeHtml(p.excerpt)}</p>
            </div>
            <div class="pill">Portfolio <small>#${escapeHtml(String(p.id))}</small></div>
          </div>
          <div class="body">
            <div class="imgWrap"><img src="${p.image}" alt="${escapeHtml(p.title)}"></div>
            <div class="text">
              <div>
                <h3>Beschrijving</h3>
                <p>${escapeHtml(p.description)}</p>
              </div>

              ${(p.tags && p.tags.length) ? `
                <div>
                  <h3>Tags</h3>
                  <div class="tags">${tagHtml}</div>
                </div>
              ` : ''}

              ${rel.length ? `
                <div>
                  <h3>See also — doorlopend</h3>
                  <div class="rel">
                    ${rel.map(o => `
                      <a href="ongoing-project.html?id=${encodeURIComponent(o.id)}">
                        <b>${escapeHtml(o.title)}</b>
                        <span>${escapeHtml(o.year)}</span>
                      </a>
                    `).join('')}
                  </div>
                </div>
              ` : ''}
            </div>
          </div>
        </article>
      `;
    }

    function escapeHtml(str){
      return String(str ?? "").replace(/[&<>"']/g, s => ({"&":"&amp;","<":"&lt;",">":"&gt;",'"':"&quot;","'":"&#39;"}[s]));
    }

    document.getElementById('y').textContent = new Date().getFullYear();
  </script>
</body>
</html>
